<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinix Cup 2025 - Group Draw</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Lato:wght@400;700&display=swap');

        :root {
            --primary-color: #007bff; /* Bright Blue */
            --secondary-color: #28a745; /* Green */
            --accent-color: #ffc107; /* Yellow */
            --background-color: #f8f9fa; /* Light Grey */
            --text-color: #343a40; /* Dark Grey */
            --group-a-bg: #17a2b8; /* Cyan */
            --group-b-bg: #6f42c1; /* Purple */
            --group-c-bg: #fd7e14; /* Orange */
            --group-d-bg: #20c997; /* Teal */
            --group-e-bg: #e74c3c; /* Red */
            --card-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }

        body {
            font-family: 'Lato', sans-serif;
            background: linear-gradient(to right, #e0f7fa, #e8f5e9);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-height: 100vh;
        }

        .navbar {
            width: 100%;
            max-width: 900px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .navbar a {
            font-family: 'Poppins', sans-serif;
            text-decoration: none;
            color: #fff;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: bold;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }
        
        .navbar a.active {
            background-color: var(--primary-color);
        }

        .navbar a:hover:not(.active) {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        .navbar .male-link { background-color: var(--primary-color); }
        .navbar .female-link { background-color: #dc3545; }
        .navbar .doubles-link { background-color: #008080; }
        .navbar .female-doubles-link { background-color: #9c27b0; }
        .navbar .mixed-doubles-link { background-color: #e67e22; }

        .container {
            width: 100%;
            max-width: 900px;
            background-color: #fff;
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            padding: 30px;
            box-sizing: border-box;
            border: 3px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: -50px;
            left: -50px;
            width: 150px;
            height: 150px;
            background-color: var(--accent-color);
            border-radius: 50%;
            opacity: 0.1;
            z-index: 0;
        }
        .container::after {
            content: '';
            position: absolute;
            bottom: -50px;
            right: -50px;
            width: 200px;
            height: 200px;
            background-color: var(--secondary-color);
            border-radius: 50%;
            opacity: 0.08;
            z-index: 0;
        }

        h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.8em;
            color: var(--primary-color);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }

        h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 2em;
            color: var(--secondary-color);
            text-transform: uppercase;
            margin-top: 5px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .spin-wheel-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 30px;
            position: relative;
            z-index: 1;
        }

        .wheel-container {
            width: 500px;
            height: 500px;
            position: relative;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
            border-radius: 50%;
            background-color: #f0f8ff;
            border: 5px solid var(--primary-color);
            overflow: hidden;
        }

        .wheel-canvas {
            width: 100%;
            height: 100%;
            display: block;
            transform: rotate(0deg);
            transition: transform 5s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        .spin-button {
            font-family: 'Poppins', sans-serif;
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            padding: 18px 35px;
            font-size: 1.3em;
            font-weight: bold;
            text-transform: uppercase;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
            transition: transform 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            border: 2px solid #fff;
            letter-spacing: 1px;
        }

        .spin-button:disabled {
            background-color: #adb5bd;
            cursor: not-allowed;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .spin-button:hover:not(:disabled) {
            transform: translate(-50%, -50%) scale(1.08);
            background-color: #0056b3;
            box-shadow: 10px 25px rgba(0, 0, 0, 0.3);
        }

        .pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 25px solid transparent;
            border-right: 25px solid transparent;
            border-bottom: 40px solid var(--accent-color);
            z-index: 5;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }

        .results-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px dashed #ced4da;
            position: relative;
            z-index: 1;
        }

        .results-section h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 2em;
            color: var(--primary-color);
            margin-bottom: 25px;
        }

        .groups-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 30px;
            margin-top: 20px;
        }

        .group-card {
            width: 100%;
            max-width: 500px;
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--card-shadow);
            text-align: left;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            color: #fff;
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
        }

        .group-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255,255,255,0.1), rgba(0,0,0,0.1));
            z-index: 0;
        }

        .group-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 1rem 2rem rgba(0, 0, 0, 0.2);
        }

        #male-group-a, #doubles-group-a, #mixed-doubles-group-a { background-color: var(--group-a-bg); border: 2px solid var(--group-a-bg); }
        #male-group-b, #doubles-group-b, #mixed-doubles-group-b { background-color: var(--group-b-bg); border: 2px solid var(--group-b-bg); }
        #female-group-a, #female-doubles-group-c { background-color: var(--group-c-bg); border: 2px solid var(--group-c-bg); }
        #female-group-b, #female-doubles-group-d { background-color: var(--group-d-bg); border: 2px solid var(--group-d-bg); }
        #female-group-c { background-color: var(--group-c-bg); border: 2px solid var(--group-c-bg); }
        #female-group-d { background-color: var(--group-d-bg); border: 2px solid var(--group-d-bg); }

        .group-card h3 {
            font-family: 'Poppins', sans-serif;
            margin-top: 0;
            border-bottom: 2px solid rgba(255, 255, 255, 0.6);
            padding-bottom: 10px;
            margin-bottom: 15px;
            font-size: 1.8em;
            text-align: center;
            color: #fff;
            position: relative;
            z-index: 1;
        }

        .group-card ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
            position: relative;
            z-index: 1;
        }

        .group-card li {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            font-size: 1.1em;
        }
        .group-card li:last-child { border-bottom: none; }
        .participant-name { font-weight: 600; margin-bottom: 2px; }
        .participant-department { font-size: 0.9em; font-style: italic; opacity: 0.9; }

        .final-results-container {
            display: none;
            width: 100%;
            max-width: 600px;
            margin: 40px auto;
            text-align: left;
            padding: 30px;
            border-radius: 15px;
            box-shadow: var(--card-shadow);
            background-color: #fff;
            border: 3px solid var(--primary-color);
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .final-results-container h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.2em;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
        }

        .final-group {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ced4da;
        }
        .final-group:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .final-group-header {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8em;
            font-weight: bold;
            color: #fff;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            text-align: center;
        }

        #male-final-group-a-header, #doubles-final-group-a-header, #mixed-doubles-final-group-a-header { background-color: var(--group-a-bg); }
        #male-final-group-b-header, #doubles-final-group-b-header, #mixed-doubles-final-group-b-header { background-color: var(--group-b-bg); }
        #female-final-group-a-header, #female-doubles-final-group-c-header { background-color: var(--group-c-bg); }
        #female-final-group-b-header, #female-doubles-final-group-d-header { background-color: var(--group-d-bg); }
        #female-final-group-c-header { background-color: var(--group-c-bg); }
        #female-final-group-d-header { background-color: var(--group-d-bg); }

        .final-group ul { list-style-type: none; padding: 0; margin: 0; }
        .final-group li { font-size: 1.1em; padding: 8px 0; border-bottom: 1px dashed #ced4da; }
        .final-group li:last-child { border-bottom: none; }

        /* Pop-up Styles */
        #popup {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background-color: #fff; border-radius: 20px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
            padding: 40px 50px; z-index: 100; text-align: center; opacity: 0;
            transition: opacity 0.5s ease-in-out; border: 4px solid var(--accent-color);
        }
        #popup.show { display: block; opacity: 1; }
        #popup h4 { font-family: 'Poppins', sans-serif; font-size: 2.5em; color: var(--primary-color); margin: 0 0 10px 0; text-transform: uppercase; }
        #popup p { font-family: 'Lato', sans-serif; font-size: 1.8em; font-weight: bold; color: var(--secondary-color); margin: 0; }
        
        #overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px); z-index: 99;
        }
        #overlay.show { display: block; }
    </style>
</head>
<body>
    <div class="navbar">
        <a id="male-link" class="male-link active">Male Singles</a>
        <a id="female-link" class="female-link">Female Singles</a>
        <a id="doubles-link" class="doubles-link">Male Doubles</a>
        <a id="female-doubles-link" class="female-doubles-link">Female Doubles</a>
        <a id="mixed-doubles-link" class="mixed-doubles-link">Mixed Doubles</a>
    </div>

    <div class="container" id="male-draw-container">
        <h1>Clinix Cup 2025</h1>
        <h2>Male Singles Grouping Draw</h2>
        
        <div id="male-draw-process">
            <div class="spin-wheel-section">
                <div class="wheel-container">
                    <div class="pointer"></div>
                    <canvas id="male-wheel-canvas" class="wheel-canvas" width="700" height="700"></canvas>
                    <button id="male-spin-button" class="spin-button">Spin to Draw</button>
                </div>
            </div>
            <div class="results-section">
                <h3>Draw Results</h3>
                <div class="groups-container">
                    <div id="male-group-a" class="group-card">
                        <h3>Group A (6 Participants)</h3>
                        <ul id="male-group-a-list"></ul>
                    </div>
                    <div id="male-group-b" class="group-card">
                        <h3>Group B (7 Participants)</h3>
                        <ul id="male-group-b-list"></ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="male-final-results-container" class="final-results-container">
            <h3>Final Clinix Cup 2025 Grouping</h3>
            <div class="final-group">
                <div id="male-final-group-a-header" class="final-group-header">Group A</div>
                <ul id="male-final-group-a-list"></ul>
            </div>
            <div class="final-group">
                <div id="male-final-group-b-header" class="final-group-header">Group B</div>
                <ul id="male-final-group-b-list"></ul>
            </div>
        </div>
    </div>

    <div class="container" id="female-draw-container" style="display: none;">
        <h1>Clinix Cup 2025</h1>
        <h2>Female Singles Grouping Draw</h2>
        
        <div id="female-draw-process">
            <div class="spin-wheel-section">
                <div class="wheel-container">
                    <div class="pointer"></div>
                    <canvas id="female-wheel-canvas" class="wheel-canvas" width="700" height="700"></canvas>
                    <button id="female-spin-button" class="spin-button">Spin to Draw</button>
                </div>
            </div>
            <div class="results-section">
                <h3>Draw Results</h3>
                <div class="groups-container">
                    <div id="female-group-a" class="group-card">
                        <h3>Group A (3 Participants)</h3>
                        <ul id="female-group-a-list"></ul>
                    </div>
                    <div id="female-group-b" class="group-card">
                        <h3>Group B (3 Participants)</h3>
                        <ul id="female-group-b-list"></ul>
                    </div>
                    <div id="female-group-c" class="group-card">
                        <h3>Group C (4 Participants)</h3>
                        <ul id="female-group-c-list"></ul>
                    </div>
                    <div id="female-group-d" class="group-card">
                        <h3>Group D (4 Participants)</h3>
                        <ul id="female-group-d-list"></ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="female-final-results-container" class="final-results-container">
            <h3>Final Clinix Cup 2025 Grouping</h3>
            <div class="final-group">
                <div id="female-final-group-a-header" class="final-group-header">Group A</div>
                <ul id="female-final-group-a-list"></ul>
            </div>
            <div class="final-group">
                <div id="female-final-group-b-header" class="final-group-header">Group B</div>
                <ul id="female-final-group-b-list"></ul>
            </div>
            <div class="final-group">
                <div id="female-final-group-c-header" class="final-group-header">Group C</div>
                <ul id="female-final-group-c-list"></ul>
            </div>
            <div class="final-group">
                <div id="female-final-group-d-header" class="final-group-header">Group D</div>
                <ul id="female-final-group-d-list"></ul>
            </div>
        </div>
    </div>
    
    <div class="container" id="doubles-draw-container" style="display: none;">
        <h1>Clinix Cup 2025</h1>
        <h2>Male Doubles Grouping Draw</h2>
        
        <div id="doubles-draw-process">
            <div class="spin-wheel-section">
                <div class="wheel-container">
                    <div class="pointer"></div>
                    <canvas id="doubles-wheel-canvas" class="wheel-canvas" width="700" height="700"></canvas>
                    <button id="doubles-spin-button" class="spin-button">Spin to Draw</button>
                </div>
            </div>
            <div class="results-section">
                <h3>Draw Results</h3>
                <div class="groups-container">
                    <div id="doubles-group-a" class="group-card">
                        <h3>Group A (6 Teams)</h3>
                        <ul id="doubles-group-a-list"></ul>
                    </div>
                    <div id="doubles-group-b" class="group-card">
                        <h3>Group B (7 Teams)</h3>
                        <ul id="doubles-group-b-list"></ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="doubles-final-results-container" class="final-results-container">
            <h3>Final Clinix Cup 2025 Grouping</h3>
            <div class="final-group">
                <div id="doubles-final-group-a-header" class="final-group-header">Group A</div>
                <ul id="doubles-final-group-a-list"></ul>
            </div>
            <div class="final-group">
                <div id="doubles-final-group-b-header" class="final-group-header">Group B</div>
                <ul id="doubles-final-group-b-list"></ul>
            </div>
        </div>
    </div>

    <div class="container" id="female-doubles-draw-container" style="display: none;">
        <h1>Clinix Cup 2025</h1>
        <h2>Female Doubles Grouping Draw</h2>
        
        <div id="female-doubles-draw-process">
            <div class="spin-wheel-section">
                <div class="wheel-container">
                    <div class="pointer"></div>
                    <canvas id="female-doubles-wheel-canvas" class="wheel-canvas" width="700" height="700"></canvas>
                    <button id="female-doubles-spin-button" class="spin-button">Spin to Draw</button>
                </div>
            </div>
            <div class="results-section">
                <h3>Draw Results</h3>
                <div class="groups-container">
                    <div id="female-doubles-group-a" class="group-card">
                        <h3>Group A (2 Teams)</h3>
                        <ul id="female-doubles-group-a-list"></ul>
                    </div>
                    <div id="female-doubles-group-b" class="group-card">
                        <h3>Group B (3 Teams)</h3>
                        <ul id="female-doubles-group-b-list"></ul>
                    </div>
                    <div id="female-doubles-group-c" class="group-card">
                        <h3>Group C (3 Teams)</h3>
                        <ul id="female-doubles-group-c-list"></ul>
                    </div>
                    <div id="female-doubles-group-d" class="group-card">
                        <h3>Group D (3 Teams)</h3>
                        <ul id="female-doubles-group-d-list"></ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="female-doubles-final-results-container" class="final-results-container">
            <h3>Final Clinix Cup 2025 Grouping</h3>
            <div class="final-group">
                <div id="female-doubles-final-group-a-header" class="final-group-header">Group A</div>
                <ul id="female-doubles-final-group-a-list"></ul>
            </div>
            <div class="final-group">
                <div id="female-doubles-final-group-b-header" class="final-group-header">Group B</div>
                <ul id="female-doubles-final-group-b-list"></ul>
            </div>
            <div class="final-group">
                <div id="female-doubles-final-group-c-header" class="final-group-header">Group C</div>
                <ul id="female-doubles-final-group-c-list"></ul>
            </div>
            <div class="final-group">
                <div id="female-doubles-final-group-d-header" class="final-group-header">Group D</div>
                <ul id="female-doubles-final-group-d-list"></ul>
            </div>
        </div>
    </div>
    
    <div class="container" id="mixed-doubles-draw-container" style="display: none;">
        <h1>Clinix Cup 2025</h1>
        <h2>Mixed Doubles Grouping Draw</h2>
        
        <div id="mixed-doubles-draw-process">
            <div class="spin-wheel-section">
                <div class="wheel-container">
                    <div class="pointer"></div>
                    <canvas id="mixed-doubles-wheel-canvas" class="wheel-canvas" width="700" height="700"></canvas>
                    <button id="mixed-doubles-spin-button" class="spin-button">Spin to Draw</button>
                </div>
            </div>
            <div class="results-section">
                <h3>Draw Results</h3>
                <div class="groups-container">
                    <div id="mixed-doubles-group-a" class="group-card">
                        <h3>Group A (6 Teams)</h3>
                        <ul id="mixed-doubles-group-a-list"></ul>
                    </div>
                    <div id="mixed-doubles-group-b" class="group-card">
                        <h3>Group B (7 Teams)</h3>
                        <ul id="mixed-doubles-group-b-list"></ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="mixed-doubles-final-results-container" class="final-results-container">
            <h3>Final Clinix Cup 2025 Grouping</h3>
            <div class="final-group">
                <div id="mixed-doubles-final-group-a-header" class="final-group-header">Group A</div>
                <ul id="mixed-doubles-final-group-a-list"></ul>
            </div>
            <div class="final-group">
                <div id="mixed-doubles-final-group-b-header" class="final-group-header">Group B</div>
                <ul id="mixed-doubles-final-group-b-list"></ul>
            </div>
        </div>
    </div>

    <div id="overlay"></div>
    <div id="popup">
        <p id="popup-name"></p>
        <h4 id="popup-group"></h4>
    </div>

    <script>
        const departmentColors = {
            'CARDIOLOGY': '#e74c3c',
            'NURSING': '#3498db',
            'ANAESTHESIA & INT. CARE': '#9b59b6',
            'ED & PCHC': '#1abc9c',
            'CARDIOTHORACIC': '#f39c12'
        };

        // Helper functions
        function truncateText(text, maxWidth, font, canvasContext) {
            canvasContext.font = font;
            let width = canvasContext.measureText(text).width;
            if (width <= maxWidth) {
                return text;
            }
            let ellipsis = '...';
            let ellipsisWidth = canvasContext.measureText(ellipsis).width;
            let tempText = text;
            while (width >= maxWidth - ellipsisWidth && tempText.length > 0) {
                tempText = tempText.substring(0, tempText.length - 1);
                width = canvasContext.measureText(tempText).width;
            }
            return tempText + ellipsis;
        }

        function showPopup(name, group) {
            const popup = document.getElementById('popup');
            const popupName = document.getElementById('popup-name');
            const popupGroup = document.getElementById('popup-group');
            const overlay = document.getElementById('overlay');
            
            popupName.textContent = name;
            popupGroup.textContent = `GROUP ${group}`;
            
            overlay.classList.add('show');
            popup.classList.add('show');
            
            setTimeout(() => {
                popup.classList.remove('show');
                overlay.classList.remove('show');
            }, 1800);
        }
        
        function shuffle(array) {
            let shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // --- Male Singles Draw Logic ---
        const maleParticipants = [
            { name: 'Koh Hui Beng', department: 'CARDIOLOGY' },
            { name: 'Ow Ji Ken', department: 'CARDIOLOGY' },
            { name: 'Faiz Mashood', department: 'CARDIOLOGY' },
            { name: 'Haizul Iskandar Sapawi', department: 'NURSING' },
            { name: 'Muhammad Danial Zulkepli', department: 'NURSING' },
            { name: 'Muhammad Nasarudin', department: 'NURSING' },
            { name: 'Mohd Amir Hakim', department: 'ANAESTHESIA & INT. CARE' },
            { name: 'Dr Eizzuddin', department: 'ANAESTHESIA & INT. CARE' },
            { name: 'Mohd Ariff Nasri', department: 'ED & PCHC' },
            { name: 'Dr Mohd Nizam Mahmud', department: 'ED & PCHC' },
            { name: 'Zahid', department: 'CARDIOTHORACIC' },
            { name: 'Dr Nazrin', department: 'CARDIOTHORACIC' },
            { name: 'Dr Mohd Azri', department: 'CARDIOTHORACIC' }
        ];

        let maleAvailableParticipants = shuffle(maleParticipants);
        let maleGroupA = [];
        let maleGroupB = [];
        let maleCurrentRotation = 0;

        const maleWheelCanvas = document.getElementById('male-wheel-canvas');
        const maleCtx = maleWheelCanvas.getContext('2d');
        const maleSpinButton = document.getElementById('male-spin-button');
        const maleGroupAList = document.getElementById('male-group-a-list');
        const maleGroupBList = document.getElementById('male-group-b-list');
        const maleDrawProcessSection = document.getElementById('male-draw-process');
        const maleFinalResultsContainer = document.getElementById('male-final-results-container');
        const maleFinalGroupAList = document.getElementById('male-final-group-a-list');
        const maleFinalGroupBList = document.getElementById('male-final-group-b-list');

        function maleDrawWheel() {
            if (maleAvailableParticipants.length === 0) {
                maleCtx.clearRect(0, 0, maleWheelCanvas.width, maleWheelCanvas.height);
                return;
            }

            const centerX = maleWheelCanvas.width / 2;
            const centerY = maleWheelCanvas.height / 2;
            const radius = Math.min(centerX, centerY) - 20;
            const arcSize = (360 / maleAvailableParticipants.length);

            maleCtx.clearRect(0, 0, maleWheelCanvas.width, maleWheelCanvas.height);
            maleCtx.strokeStyle = '#fff';
            maleCtx.lineWidth = 3;

            maleAvailableParticipants.forEach((p, i) => {
                const angleStart = (i * arcSize) * (Math.PI / 180);
                const angleEnd = ((i + 1) * arcSize) * (Math.PI / 180);
                const color = departmentColors[p.department] || '#ccc';
                
                maleCtx.beginPath();
                maleCtx.moveTo(centerX, centerY);
                maleCtx.arc(centerX, centerY, radius, angleStart, angleEnd);
                maleCtx.closePath();
                maleCtx.fillStyle = color;
                maleCtx.fill();
                maleCtx.stroke();

                maleCtx.save();
                maleCtx.translate(centerX, centerY);
                maleCtx.rotate((angleStart + angleEnd) / 2);
                maleCtx.fillStyle = '#fff';
                maleCtx.font = 'bold 20px "Poppins", sans-serif';
                maleCtx.textAlign = 'right';
                maleCtx.textBaseline = 'middle';
                
                const textMargin = 30;
                const maxTextWidth = radius - textMargin - 10;
                const displayedName = truncateText(p.name, maxTextWidth, maleCtx.font, maleCtx);

                maleCtx.fillText(displayedName, radius - textMargin, 0);
                maleCtx.restore();
            });

            maleCtx.beginPath();
            maleCtx.arc(centerX, centerY, 80, 0, 2 * Math.PI);
            maleCtx.fillStyle = '#f8f9fa';
            maleCtx.fill();
            maleCtx.strokeStyle = '#007bff';
            maleCtx.lineWidth = 5;
            maleCtx.stroke();
        }

        function maleSpinWheel() {
            if (maleGroupA.length === 6) {
                maleFillGroupB();
                return;
            }
            if (maleAvailableParticipants.length === 0) return;

            maleSpinButton.disabled = true;
            maleSpinButton.innerText = 'Spinning...';

            const randomIndex = Math.floor(Math.random() * maleAvailableParticipants.length);
            const degreesPerSegment = 360 / maleAvailableParticipants.length;

            const targetSegmentStartAngle = randomIndex * degreesPerSegment;
            const targetRotation = (360 * 5) + (270 - targetSegmentStartAngle) - (degreesPerSegment / 2);

            maleWheelCanvas.style.transition = 'transform 5s cubic-bezier(0.25, 0.1, 0.25, 1)';
            maleWheelCanvas.style.transform = `rotate(${targetRotation}deg)`;

            setTimeout(() => {
                maleCurrentRotation = targetRotation % 360;
                maleWheelCanvas.style.transition = 'none';
                maleWheelCanvas.style.transform = `rotate(${maleCurrentRotation}deg)`;

                const drawnParticipant = maleAvailableParticipants.splice(randomIndex, 1)[0];
                const groupName = maleGroupA.length < 6 ? 'A' : 'B';
                showPopup(drawnParticipant.name, groupName);
                
                setTimeout(() => {
                    maleAddToGroup(drawnParticipant);
                    maleDrawWheel();
                    if (maleGroupA.length === 6) {
                        maleFillGroupB();
                    } else if (maleAvailableParticipants.length > 0) {
                        maleSpinButton.disabled = false;
                        maleSpinButton.innerText = 'Spin to Draw';
                    } else {
                        maleDisplayFinalResults();
                    }
                }, 2000);
            }, 5000);
        }

        function maleAddToGroup(participant) {
            const groupA_size = 6;
            let targetGroup = null;
            if (maleGroupA.length < groupA_size) {
                maleGroupA.push(participant);
                targetGroup = maleGroupAList;
            }
            const listItem = document.createElement('li');
            listItem.innerHTML = `<span class="participant-name">${participant.name}</span> <span class="participant-department">(${participant.department})</span>`;
            targetGroup.appendChild(listItem);
        }
        
        function maleFillGroupB() {
            maleSpinButton.disabled = true;
            maleSpinButton.innerText = 'Finalizing Group B...';
            
            maleAvailableParticipants.forEach(participant => {
                maleGroupB.push(participant);
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span class="participant-name">${participant.name}</span> <span class="participant-department">(${participant.department})</span>`;
                maleGroupBList.appendChild(listItem);
            });
            maleAvailableParticipants = [];
            
            maleDisplayFinalResults();
        }

        function maleDisplayFinalResults() {
            maleDrawProcessSection.style.display = 'none';
            maleFinalResultsContainer.style.display = 'block';

            maleGroupA.forEach(p => {
                const listItem = document.createElement('li');
                listItem.textContent = p.name;
                maleFinalGroupAList.appendChild(listItem);
            });
            maleGroupB.forEach(p => {
                const listItem = document.createElement('li');
                listItem.textContent = p.name;
                maleFinalGroupBList.appendChild(listItem);
            });
        }
        
        maleSpinButton.addEventListener('click', maleSpinWheel);

        // --- Female Singles Draw Logic ---
        const femaleParticipants = [
            { name: 'Nabila', department: 'CARDIOLOGY' },
            { name: 'Fuziana', department: 'CARDIOLOGY' },
            { name: 'Nik Hasnita', department: 'CARDIOLOGY' },
            { name: 'Navanita', department: 'CARDIOLOGY' },
            { name: 'Jassie Teo', department: 'CARDIOLOGY' },
            { name: 'Nor Atika', department: 'NURSING' },
            { name: 'Wani Irdina', department: 'NURSING' },
            { name: 'Nawwar Nazihah Ikramah', department: 'NURSING' },
            { name: 'Dr Kogilavani', department: 'ANAESTHESIA & INT. CARE' },
            { name: 'Siti Khadijah', department: 'ANAESTHESIA & INT. CARE' },
            { name: 'Siti Norfazidah', department: 'ANAESTHESIA & INT. CARE' },
            { name: 'Ruhaida Abdullah', department: 'ED & PCHC' },
            { name: 'SA Hamzi', department: 'CARDIOTHORACIC' },
            { name: 'Aimie', department: 'CARDIOTHORACIC' }
        ];

        let femaleAvailableParticipants = shuffle(femaleParticipants);
        let femaleGroupA = [];
        let femaleGroupB = [];
        let femaleGroupC = [];
        let femaleGroupD = [];
        let femaleCurrentRotation = 0;

        const femaleWheelCanvas = document.getElementById('female-wheel-canvas');
        const femaleCtx = femaleWheelCanvas.getContext('2d');
        const femaleSpinButton = document.getElementById('female-spin-button');
        const femaleGroupAList = document.getElementById('female-group-a-list');
        const femaleGroupBList = document.getElementById('female-group-b-list');
        const femaleGroupCList = document.getElementById('female-group-c-list');
        const femaleGroupDList = document.getElementById('female-group-d-list');
        const femaleDrawProcessSection = document.getElementById('female-draw-process');
        const femaleFinalResultsContainer = document.getElementById('female-final-results-container');
        const femaleFinalGroupAList = document.getElementById('female-final-group-a-list');
        const femaleFinalGroupBList = document.getElementById('female-final-group-b-list');
        const femaleFinalGroupCList = document.getElementById('female-final-group-c-list');
        const femaleFinalGroupDList = document.getElementById('female-final-group-d-list');

        function femaleDrawWheel() {
            if (femaleAvailableParticipants.length === 0) {
                femaleCtx.clearRect(0, 0, femaleWheelCanvas.width, femaleWheelCanvas.height);
                return;
            }

            const centerX = femaleWheelCanvas.width / 2;
            const centerY = femaleWheelCanvas.height / 2;
            const radius = Math.min(centerX, centerY) - 20;
            const arcSize = (360 / femaleAvailableParticipants.length);

            femaleCtx.clearRect(0, 0, femaleWheelCanvas.width, femaleWheelCanvas.height);
            femaleCtx.strokeStyle = '#fff';
            femaleCtx.lineWidth = 3;

            femaleAvailableParticipants.forEach((p, i) => {
                const angleStart = (i * arcSize) * (Math.PI / 180);
                const angleEnd = ((i + 1) * arcSize) * (Math.PI / 180);
                const color = departmentColors[p.department] || '#ccc';
                
                femaleCtx.beginPath();
                femaleCtx.moveTo(centerX, centerY);
                femaleCtx.arc(centerX, centerY, radius, angleStart, angleEnd);
                femaleCtx.closePath();
                femaleCtx.fillStyle = color;
                femaleCtx.fill();
                femaleCtx.stroke();

                femaleCtx.save();
                femaleCtx.translate(centerX, centerY);
                femaleCtx.rotate((angleStart + angleEnd) / 2);
                femaleCtx.fillStyle = '#fff';
                femaleCtx.font = 'bold 20px "Poppins", sans-serif';
                femaleCtx.textAlign = 'right';
                femaleCtx.textBaseline = 'middle';
                
                const textMargin = 30;
                const maxTextWidth = radius - textMargin - 10;
                const displayedName = truncateText(p.name, maxTextWidth, femaleCtx.font, femaleCtx);

                femaleCtx.fillText(displayedName, radius - textMargin, 0);
                femaleCtx.restore();
            });

            femaleCtx.beginPath();
            femaleCtx.arc(centerX, centerY, 80, 0, 2 * Math.PI);
            femaleCtx.fillStyle = '#f8f9fa';
            femaleCtx.fill();
            femaleCtx.strokeStyle = '#007bff';
            femaleCtx.lineWidth = 5;
            femaleCtx.stroke();
        }

        function femaleSpinWheel() {
            if (femaleAvailableParticipants.length === 0) {
                femaleDisplayFinalResults();
                return;
            }

            femaleSpinButton.disabled = true;
            femaleSpinButton.innerText = 'Spinning...';

            const randomIndex = Math.floor(Math.random() * femaleAvailableParticipants.length);
            const degreesPerSegment = 360 / femaleAvailableParticipants.length;

            const targetSegmentStartAngle = randomIndex * degreesPerSegment;
            const targetRotation = (360 * 5) + (270 - targetSegmentStartAngle) - (degreesPerSegment / 2);

            femaleWheelCanvas.style.transition = 'transform 5s cubic-bezier(0.25, 0.1, 0.25, 1)';
            femaleWheelCanvas.style.transform = `rotate(${targetRotation}deg)`;

            setTimeout(() => {
                femaleCurrentRotation = targetRotation % 360;
                femaleWheelCanvas.style.transition = 'none';
                femaleWheelCanvas.style.transform = `rotate(${femaleCurrentRotation}deg)`;

                const drawnParticipant = femaleAvailableParticipants.splice(randomIndex, 1)[0];
                let groupName = '';
                if (femaleGroupA.length < 3) groupName = 'A';
                else if (femaleGroupB.length < 3) groupName = 'B';
                else if (femaleGroupC.length < 4) groupName = 'C';
                else groupName = 'D';

                showPopup(drawnParticipant.name, groupName);
                
                setTimeout(() => {
                    femaleAddToGroup(drawnParticipant);
                    femaleDrawWheel();
                    if (femaleGroupA.length + femaleGroupB.length + femaleGroupC.length === 10) {
                        femaleFillGroupD();
                    } else if (femaleAvailableParticipants.length > 0) {
                        femaleSpinButton.disabled = false;
                        femaleSpinButton.innerText = 'Spin to Draw';
                    } else {
                        femaleDisplayFinalResults();
                    }
                }, 2000);
            }, 5000);
        }

        function femaleAddToGroup(participant) {
            if (femaleGroupA.length < 3) {
                femaleGroupA.push(participant);
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span class="participant-name">${participant.name}</span> <span class="participant-department">(${participant.department})</span>`;
                femaleGroupAList.appendChild(listItem);
            } else if (femaleGroupB.length < 3) {
                femaleGroupB.push(participant);
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span class="participant-name">${participant.name}</span> <span class="participant-department">(${participant.department})</span>`;
                femaleGroupBList.appendChild(listItem);
            } else if (femaleGroupC.length < 4) {
                femaleGroupC.push(participant);
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span class="participant-name">${participant.name}</span> <span class="participant-department">(${participant.department})</span>`;
                femaleGroupCList.appendChild(listItem);
            } else { 
                femaleGroupD.push(participant);
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span class="participant-name">${participant.name}</span> <span class="participant-department">(${participant.department})</span>`;
                femaleGroupDList.appendChild(listItem);
            }
        }
        
        function femaleFillGroupD() {
            femaleSpinButton.disabled = true;
            femaleSpinButton.innerText = 'Finalizing Group D...';
            
            femaleAvailableParticipants.forEach(participant => {
                femaleGroupD.push(participant);
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span class="participant-name">${participant.name}</span> <span class="participant-department">(${participant.department})</span>`;
                femaleGroupDList.appendChild(listItem);
            });
            femaleAvailableParticipants = [];
            
            femaleDisplayFinalResults();
        }

        function femaleDisplayFinalResults() {
            femaleDrawProcessSection.style.display = 'none';
            femaleFinalResultsContainer.style.display = 'block';

            femaleGroupA.forEach(p => {
                const listItem = document.createElement('li');
                listItem.textContent = p.name;
                femaleFinalGroupAList.appendChild(listItem);
            });
            femaleGroupB.forEach(p => {
                const listItem = document.createElement('li');
                listItem.textContent = p.name;
                femaleFinalGroupBList.appendChild(listItem);
            });
            femaleGroupC.forEach(p => {
                const listItem = document.createElement('li');
                listItem.textContent = p.name;
                femaleFinalGroupCList.appendChild(listItem);
            });
            femaleGroupD.forEach(p => {
                const listItem = document.createElement('li');
                listItem.textContent = p.name;
                femaleFinalGroupDList.appendChild(listItem);
            });
        }
        
        femaleSpinButton.addEventListener('click', femaleSpinWheel);

        // --- Male Doubles Draw Logic ---
        const doublesTeams = [
            { name: 'Koh Hui Beng & Ow Ji Ken', department: 'CARDIOLOGY' },
            { name: 'Azlan Shah & Faiz Mashood', department: 'CARDIOLOGY' },
            { name: 'Ariff & Tantawi', department: 'CARDIOLOGY' },
            { name: 'Muhd Syafiq & Ruzaidi Ramlee', department: 'NURSING' },
            { name: 'Amirul Asyraf Abdullah & Ahmad Yahya Khirudin', department: 'NURSING' },
            { name: 'Khairul Anuar & Ahmad Azahar Adnan', department: 'NURSING' },
            { name: 'Dr Zahrin & Dr Ignatius', department: 'ANAESTHESIA & INT. CARE' },
            { name: 'Mohd Syukri & Mohd Amir Hakim', department: 'ANAESTHESIA & INT. CARE' },
            { name: 'Dzulhelmy & Mohd Hafizhin', department: 'ANAESTHESIA & INT. CARE' },
            { name: 'Mohd Firdaus Ibrahim & Dr Faiz Farhan', department: 'ED & PCHC' },
            { name: 'Dr Ahmad Syarafi & Dr Leong Ming Chern', department: 'ED & PCHC' },
            { name: 'Zahid & Anas', department: 'CARDIOTHORACIC' },
            { name: 'Izzad & Mohd Azri', department: 'CARDIOTHORACIC' }
        ];

        let doublesAvailableTeams = shuffle(doublesTeams);
        let doublesGroupA = [];
        let doublesGroupB = [];
        let doublesCurrentRotation = 0;

        const doublesWheelCanvas = document.getElementById('doubles-wheel-canvas');
        const doublesCtx = doublesWheelCanvas.getContext('2d');
        const doublesSpinButton = document.getElementById('doubles-spin-button');
        const doublesGroupAList = document.getElementById('doubles-group-a-list');
        const doublesGroupBList = document.getElementById('doubles-group-b-list');
        const doublesDrawProcessSection = document.getElementById('doubles-draw-process');
        const doublesFinalResultsContainer = document.getElementById('doubles-final-results-container');
        const doublesFinalGroupAList = document.getElementById('doubles-final-group-a-list');
        const doublesFinalGroupBList = document.getElementById('doubles-final-group-b-list');

        function doublesDrawWheel() {
            if (doublesAvailableTeams.length === 0) {
                doublesCtx.clearRect(0, 0, doublesWheelCanvas.width, doublesWheelCanvas.height);
                return;
            }

            const centerX = doublesWheelCanvas.width / 2;
            const centerY = doublesWheelCanvas.height / 2;
            const radius = Math.min(centerX, centerY) - 20;
            const arcSize = (360 / doublesAvailableTeams.length);

            doublesCtx.clearRect(0, 0, doublesWheelCanvas.width, doublesWheelCanvas.height);
            doublesCtx.strokeStyle = '#fff';
            doublesCtx.lineWidth = 3;

            doublesAvailableTeams.forEach((t, i) => {
                const angleStart = (i * arcSize) * (Math.PI / 180);
                const angleEnd = ((i + 1) * arcSize) * (Math.PI / 180);
                const color = departmentColors[t.department] || '#ccc';
                
                doublesCtx.beginPath();
                doublesCtx.moveTo(centerX, centerY);
                doublesCtx.arc(centerX, centerY, radius, angleStart, angleEnd);
                doublesCtx.closePath();
                doublesCtx.fillStyle = color;
                doublesCtx.fill();
                doublesCtx.stroke();

                doublesCtx.save();
                doublesCtx.translate(centerX, centerY);
                doublesCtx.rotate((angleStart + angleEnd) / 2);
                doublesCtx.fillStyle = '#fff';
                doublesCtx.font = 'bold 20px "Poppins", sans-serif';
                doublesCtx.textAlign = 'right';
                doublesCtx.textBaseline = 'middle';
                
                const textMargin = 30;
                const maxTextWidth = radius - textMargin - 10;
                const displayedName = truncateText(t.name, maxTextWidth, doublesCtx.font, doublesCtx);

                doublesCtx.fillText(displayedName, radius - textMargin, 0);
                doublesCtx.restore();
            });

            doublesCtx.beginPath();
            doublesCtx.arc(centerX, centerY, 80, 0, 2 * Math.PI);
            doublesCtx.fillStyle = '#f8f9fa';
            doublesCtx.fill();
            doublesCtx.strokeStyle = '#008080';
            doublesCtx.lineWidth = 5;
            doublesCtx.stroke();
        }

        function doublesSpinWheel() {
            if (doublesGroupA.length === 6) {
                doublesFillGroupB();
                return;
            }
            if (doublesAvailableTeams.length === 0) return;

            doublesSpinButton.disabled = true;
            doublesSpinButton.innerText = 'Spinning...';

            const randomIndex = Math.floor(Math.random() * doublesAvailableTeams.length);
            const degreesPerSegment = 360 / doublesAvailableTeams.length;

            const targetSegmentStartAngle = randomIndex * degreesPerSegment;
            const targetRotation = (360 * 5) + (270 - targetSegmentStartAngle) - (degreesPerSegment / 2);

            doublesWheelCanvas.style.transition = 'transform 5s cubic-bezier(0.25, 0.1, 0.25, 1)';
            doublesWheelCanvas.style.transform = `rotate(${targetRotation}deg)`;

            setTimeout(() => {
                doublesCurrentRotation = targetRotation % 360;
                doublesWheelCanvas.style.transition = 'none';
                doublesWheelCanvas.style.transform = `rotate(${doublesCurrentRotation}deg)`;

                const drawnTeam = doublesAvailableTeams.splice(randomIndex, 1)[0];
                const groupName = doublesGroupA.length < 6 ? 'A' : 'B';
                showPopup(drawnTeam.name, groupName);
                
                setTimeout(() => {
                    doublesAddToGroup(drawnTeam);
                    doublesDrawWheel();
                    if (doublesGroupA.length === 6) {
                        doublesFillGroupB();
                    } else if (doublesAvailableTeams.length > 0) {
                        doublesSpinButton.disabled = false;
                        doublesSpinButton.innerText = 'Spin to Draw';
                    } else {
                        doublesDisplayFinalResults();
                    }
                }, 2000);
            }, 5000);
        }

        function doublesAddToGroup(team) {
            const groupA_size = 6;
            let targetGroup = null;
            if (doublesGroupA.length < groupA_size) {
                doublesGroupA.push(team);
                targetGroup = doublesGroupAList;
            }
            const listItem = document.createElement('li');
            listItem.innerHTML = `<span class="participant-name">${team.name}</span> <span class="participant-department">(${team.department})</span>`;
            targetGroup.appendChild(listItem);
        }
        
        function doublesFillGroupB() {
            doublesSpinButton.disabled = true;
            doublesSpinButton.innerText = 'Finalizing Group B...';
            
            doublesAvailableTeams.forEach(team => {
                doublesGroupB.push(team);
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span class="participant-name">${team.name}</span> <span class="participant-department">(${team.department})</span>`;
                doublesGroupBList.appendChild(listItem);
            });
            doublesAvailableTeams = [];
            
            doublesDisplayFinalResults();
        }

        function doublesDisplayFinalResults() {
            doublesDrawProcessSection.style.display = 'none';
            doublesFinalResultsContainer.style.display = 'block';

            doublesGroupA.forEach(p => {
                const listItem = document.createElement('li');
                listItem.textContent = p.name;
                doublesFinalGroupAList.appendChild(listItem);
            });
            doublesGroupB.forEach(p => {
                const listItem = document.createElement('li');
                listItem.textContent = p.name;
                doublesFinalGroupBList.appendChild(listItem);
            });
        }
        
        doublesSpinButton.addEventListener('click', doublesSpinWheel);
        
        // --- Female Doubles Draw Logic ---
        const femaleDoublesTeams = [
            { name: 'Nabila & Navanita', department: 'CARDIOLOGY' },
            { name: 'Nor Azila Hamal & Nadjatul Azwa', department: 'NURSING' },
            { name: 'Nik Hasnita Nik Ahmad & Norhidayah Mahfudz', department: 'NURSING' },
            { name: 'Nur Nadiah Atiqah & Nur Athika Abd Malik', department: 'NURSING' },
            { name: 'Dr Norhayati & Dr Siti Zubaidah', department: 'ANAESTHESIA & INT. CARE' },
            { name: 'Aufa Hannan & Siti Khadijah', department: 'ANAESTHESIA & INT. CARE' },
            { name: 'Nurul Syazwani & Siti Norfazidah', department: 'ANAESTHESIA & INT. CARE' },
            { name: 'Nurbaizura Che Mohd Zol & Narmatha A/P Asogan', department: 'ED & PCHC' },
            { name: 'Dr Wee Lee Shia & Nur Qistina', department: 'ED & PCHC' },
            { name: 'Aimie & Sharahah', department: 'CARDIOTHORACIC' },
            { name: 'Fathiyah & Arina', department: 'CARDIOTHORACIC' }
        ];

        let femaleDoublesAvailableTeams = shuffle(femaleDoublesTeams);
        let femaleDoublesGroupA = [];
        let femaleDoublesGroupB = [];
        let femaleDoublesGroupC = [];
        let femaleDoublesGroupD = [];
        let femaleDoublesCurrentRotation = 0;

        const femaleDoublesWheelCanvas = document.getElementById('female-doubles-wheel-canvas');
        const femaleDoublesCtx = femaleDoublesWheelCanvas.getContext('2d');
        const femaleDoublesSpinButton = document.getElementById('female-doubles-spin-button');
        const femaleDoublesGroupAList = document.getElementById('female-doubles-group-a-list');
        const femaleDoublesGroupBList = document.getElementById('female-doubles-group-b-list');
        const femaleDoublesGroupCList = document.getElementById('female-doubles-group-c-list');
        const femaleDoublesGroupDList = document.getElementById('female-doubles-group-d-list');
        const femaleDoublesDrawProcessSection = document.getElementById('female-doubles-draw-process');
        const femaleDoublesFinalResultsContainer = document.getElementById('female-doubles-final-results-container');
        const femaleDoublesFinalGroupAList = document.getElementById('female-doubles-final-group-a-list');
        const femaleDoublesFinalGroupBList = document.getElementById('female-doubles-final-group-b-list');
        const femaleDoublesFinalGroupCList = document.getElementById('female-doubles-final-group-c-list');
        const femaleDoublesFinalGroupDList = document.getElementById('female-doubles-final-group-d-list');

        function femaleDoublesDrawWheel() {
            if (femaleDoublesAvailableTeams.length === 0) {
                femaleDoublesCtx.clearRect(0, 0, femaleDoublesWheelCanvas.width, femaleDoublesWheelCanvas.height);
                return;
            }

            const centerX = femaleDoublesWheelCanvas.width / 2;
            const centerY = femaleDoublesWheelCanvas.height / 2;
            const radius = Math.min(centerX, centerY) - 20;
            const arcSize = (360 / femaleDoublesAvailableTeams.length);

            femaleDoublesCtx.clearRect(0, 0, femaleDoublesWheelCanvas.width, femaleDoublesWheelCanvas.height);
            femaleDoublesCtx.strokeStyle = '#fff';
            femaleDoublesCtx.lineWidth = 3;

            femaleDoublesAvailableTeams.forEach((t, i) => {
                const angleStart = (i * arcSize) * (Math.PI / 180);
                const angleEnd = ((i + 1) * arcSize) * (Math.PI / 180);
                const color = departmentColors[t.department] || '#ccc';
                
                femaleDoublesCtx.beginPath();
                femaleDoublesCtx.moveTo(centerX, centerY);
                femaleDoublesCtx.arc(centerX, centerY, radius, angleStart, angleEnd);
                femaleDoublesCtx.closePath();
                femaleDoublesCtx.fillStyle = color;
                femaleDoublesCtx.fill();
                femaleDoublesCtx.stroke();

                femaleDoublesCtx.save();
                femaleDoublesCtx.translate(centerX, centerY);
                femaleDoublesCtx.rotate((angleStart + angleEnd) / 2);
                femaleDoublesCtx.fillStyle = '#fff';
                femaleDoublesCtx.font = 'bold 20px "Poppins", sans-serif';
                femaleDoublesCtx.textAlign = 'right';
                femaleDoublesCtx.textBaseline = 'middle';
                
                const textMargin = 30;
                const maxTextWidth = radius - textMargin - 10;
                const displayedName = truncateText(t.name, maxTextWidth, femaleDoublesCtx.font, femaleDoublesCtx);

                femaleDoublesCtx.fillText(displayedName, radius - textMargin, 0);
                femaleDoublesCtx.restore();
            });

            femaleDoublesCtx.beginPath();
            femaleDoublesCtx.arc(centerX, centerY, 80, 0, 2 * Math.PI);
            femaleDoublesCtx.fillStyle = '#f8f9fa';
            femaleDoublesCtx.fill();
            femaleDoublesCtx.strokeStyle = '#9c27b0';
            femaleDoublesCtx.lineWidth = 5;
            femaleDoublesCtx.stroke();
        }

        function femaleDoublesSpinWheel() {
            if (femaleDoublesAvailableTeams.length === 0) {
                femaleDoublesDisplayFinalResults();
                return;
            }

            femaleDoublesSpinButton.disabled = true;
            femaleDoublesSpinButton.innerText = 'Spinning...';

            const randomIndex = Math.floor(Math.random() * femaleDoublesAvailableTeams.length);
            const degreesPerSegment = 360 / femaleDoublesAvailableTeams.length;

            const targetSegmentStartAngle = randomIndex * degreesPerSegment;
            const targetRotation = (360 * 5) + (270 - targetSegmentStartAngle) - (degreesPerSegment / 2);

            femaleDoublesWheelCanvas.style.transition = 'transform 5s cubic-bezier(0.25, 0.1, 0.25, 1)';
            femaleDoublesWheelCanvas.style.transform = `rotate(${targetRotation}deg)`;

            setTimeout(() => {
                femaleDoublesCurrentRotation = targetRotation % 360;
                femaleDoublesWheelCanvas.style.transition = 'none';
                femaleDoublesWheelCanvas.style.transform = `rotate(${femaleDoublesCurrentRotation}deg)`;

                const drawnTeam = femaleDoublesAvailableTeams.splice(randomIndex, 1)[0];
                let groupName = '';
                if (femaleDoublesGroupA.length < 2) groupName = 'A';
                else if (femaleDoublesGroupB.length < 3) groupName = 'B';
                else if (femaleDoublesGroupC.length < 3) groupName = 'C';
                else groupName = 'D';

                showPopup(drawnTeam.name, groupName);
                
                setTimeout(() => {
                    femaleDoublesAddToGroup(drawnTeam);
                    femaleDoublesDrawWheel();
                    if (femaleDoublesGroupA.length + femaleDoublesGroupB.length + femaleDoublesGroupC.length === 8) {
                        femaleDoublesFillGroupD();
                    } else if (femaleDoublesAvailableTeams.length > 0) {
                        femaleDoublesSpinButton.disabled = false;
                        femaleDoublesSpinButton.innerText = 'Spin to Draw';
                    } else {
                        femaleDoublesDisplayFinalResults();
                    }
                }, 2000);
            }, 5000);
        }

        function femaleDoublesAddToGroup(team) {
            if (femaleDoublesGroupA.length < 2) {
                femaleDoublesGroupA.push(team);
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span class="participant-name">${team.name}</span> <span class="participant-department">(${team.department})</span>`;
                femaleDoublesGroupAList.appendChild(listItem);
            } else if (femaleDoublesGroupB.length < 3) {
                femaleDoublesGroupB.push(team);
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span class="participant-name">${team.name}</span> <span class="participant-department">(${team.department})</span>`;
                femaleDoublesGroupBList.appendChild(listItem);
            } else if (femaleDoublesGroupC.length < 3) {
                femaleDoublesGroupC.push(team);
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span class="participant-name">${team.name}</span> <span class="participant-department">(${team.department})</span>`;
                femaleDoublesGroupCList.appendChild(listItem);
            } else { 
                femaleDoublesGroupD.push(team);
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span class="participant-name">${team.name}</span> <span class="participant-department">(${team.department})</span>`;
                femaleDoublesGroupDList.appendChild(listItem);
            }
        }
        
        function femaleDoublesFillGroupD() {
            femaleDoublesSpinButton.disabled = true;
            femaleDoublesSpinButton.innerText = 'Finalizing Group D...';
            
            femaleDoublesAvailableTeams.forEach(team => {
                femaleDoublesGroupD.push(team);
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span class="participant-name">${team.name}</span> <span class="participant-department">(${team.department})</span>`;
                femaleDoublesGroupDList.appendChild(listItem);
            });
            femaleDoublesAvailableTeams = [];
            
            femaleDoublesDisplayFinalResults();
        }

        function femaleDoublesDisplayFinalResults() {
            femaleDoublesDrawProcessSection.style.display = 'none';
            femaleDoublesFinalResultsContainer.style.display = 'block';

            femaleDoublesGroupA.forEach(p => {
                const listItem = document.createElement('li');
                listItem.textContent = p.name;
                femaleDoublesFinalGroupAList.appendChild(listItem);
            });
            femaleDoublesGroupB.forEach(p => {
                const listItem = document.createElement('li');
                listItem.textContent = p.name;
                femaleDoublesFinalGroupBList.appendChild(listItem);
            });
            femaleDoublesGroupC.forEach(p => {
                const listItem = document.createElement('li');
                listItem.textContent = p.name;
                femaleDoublesFinalGroupCList.appendChild(listItem);
            });
            femaleDoublesGroupD.forEach(p => {
                const listItem = document.createElement('li');
                listItem.textContent = p.name;
                femaleDoublesFinalGroupDList.appendChild(listItem);
            });
        }
        
        femaleDoublesSpinButton.addEventListener('click', femaleDoublesSpinWheel);

        // --- Mixed Doubles Draw Logic ---
        const mixedDoublesTeams = [
            { name: 'Jessie Teo & Ow Ji Ken', department: 'CARDIOLOGY' },
            { name: 'Faiz Mashood & Fuziana', department: 'CARDIOLOGY' },
            { name: 'Tantawi & Nabila', department: 'CARDIOLOGY' },
            { name: 'Nur Hidayatullah Muzakir & Muhammad Aman Ikmal', department: 'NURSING' },
            { name: 'Farah Natasha & Muhammad Arrasyid', department: 'NURSING' },
            { name: 'Siti Nuraisyah Ramli & Muhammad Haziq Haiqal', department: 'NURSING' },
            { name: 'Dr Kamilah & Dr Zahir', department: 'ANAESTHESIA & INT. CARE' },
            { name: 'Dzulhelmy & Siti Khadijah', department: 'ANAESTHESIA & INT. CARE' },
            { name: 'Mohd Hafizhin & Siti Norfazidah', department: 'ANAESTHESIA & INT. CARE' },
            { name: 'Ahmad Rasyid Hazmi & Norliyana Balqis', department: 'ED & PCHC' },
            { name: 'Dr Soo Kok Wai & Suhayle Sead', department: 'ED & PCHC' },
            { name: 'Dato\' Nazeri & Qalida', department: 'CARDIOTHORACIC' },
            { name: 'Dr Nazrin & SA Hamzi', department: 'CARDIOTHORACIC' }
        ];

        let mixedDoublesAvailableTeams = shuffle(mixedDoublesTeams);
        let mixedDoublesGroupA = [];
        let mixedDoublesGroupB = [];
        let mixedDoublesCurrentRotation = 0;

        const mixedDoublesWheelCanvas = document.getElementById('mixed-doubles-wheel-canvas');
        const mixedDoublesCtx = mixedDoublesWheelCanvas.getContext('2d');
        const mixedDoublesSpinButton = document.getElementById('mixed-doubles-spin-button');
        const mixedDoublesGroupAList = document.getElementById('mixed-doubles-group-a-list');
        const mixedDoublesGroupBList = document.getElementById('mixed-doubles-group-b-list');
        const mixedDoublesDrawProcessSection = document.getElementById('mixed-doubles-draw-process');
        const mixedDoublesFinalResultsContainer = document.getElementById('mixed-doubles-final-results-container');
        const mixedDoublesFinalGroupAList = document.getElementById('mixed-doubles-final-group-a-list');
        const mixedDoublesFinalGroupBList = document.getElementById('mixed-doubles-final-group-b-list');

        function mixedDoublesDrawWheel() {
            if (mixedDoublesAvailableTeams.length === 0) {
                mixedDoublesCtx.clearRect(0, 0, mixedDoublesWheelCanvas.width, mixedDoublesWheelCanvas.height);
                return;
            }

            const centerX = mixedDoublesWheelCanvas.width / 2;
            const centerY = mixedDoublesWheelCanvas.height / 2;
            const radius = Math.min(centerX, centerY) - 20;
            const arcSize = (360 / mixedDoublesAvailableTeams.length);

            mixedDoublesCtx.clearRect(0, 0, mixedDoublesWheelCanvas.width, mixedDoublesWheelCanvas.height);
            mixedDoublesCtx.strokeStyle = '#fff';
            mixedDoublesCtx.lineWidth = 3;

            mixedDoublesAvailableTeams.forEach((t, i) => {
                const angleStart = (i * arcSize) * (Math.PI / 180);
                const angleEnd = ((i + 1) * arcSize) * (Math.PI / 180);
                const color = departmentColors[t.department] || '#ccc';
                
                mixedDoublesCtx.beginPath();
                mixedDoublesCtx.moveTo(centerX, centerY);
                mixedDoublesCtx.arc(centerX, centerY, radius, angleStart, angleEnd);
                mixedDoublesCtx.closePath();
                mixedDoublesCtx.fillStyle = color;
                mixedDoublesCtx.fill();
                mixedDoublesCtx.stroke();

                mixedDoublesCtx.save();
                mixedDoublesCtx.translate(centerX, centerY);
                mixedDoublesCtx.rotate((angleStart + angleEnd) / 2);
                mixedDoublesCtx.fillStyle = '#fff';
                mixedDoublesCtx.font = 'bold 20px "Poppins", sans-serif';
                mixedDoublesCtx.textAlign = 'right';
                mixedDoublesCtx.textBaseline = 'middle';
                
                const textMargin = 30;
                const maxTextWidth = radius - textMargin - 10;
                const displayedName = truncateText(t.name, maxTextWidth, mixedDoublesCtx.font, mixedDoublesCtx);

                mixedDoublesCtx.fillText(displayedName, radius - textMargin, 0);
                mixedDoublesCtx.restore();
            });

            mixedDoublesCtx.beginPath();
            mixedDoublesCtx.arc(centerX, centerY, 80, 0, 2 * Math.PI);
            mixedDoublesCtx.fillStyle = '#f8f9fa';
            mixedDoublesCtx.fill();
            mixedDoublesCtx.strokeStyle = '#e67e22';
            mixedDoublesCtx.lineWidth = 5;
            mixedDoublesCtx.stroke();
        }

        function mixedDoublesSpinWheel() {
            if (mixedDoublesGroupA.length === 6) {
                mixedDoublesFillGroupB();
                return;
            }
            if (mixedDoublesAvailableTeams.length === 0) return;

            mixedDoublesSpinButton.disabled = true;
            mixedDoublesSpinButton.innerText = 'Spinning...';

            const randomIndex = Math.floor(Math.random() * mixedDoublesAvailableTeams.length);
            const degreesPerSegment = 360 / mixedDoublesAvailableTeams.length;

            const targetSegmentStartAngle = randomIndex * degreesPerSegment;
            const targetRotation = (360 * 5) + (270 - targetSegmentStartAngle) - (degreesPerSegment / 2);

            mixedDoublesWheelCanvas.style.transition = 'transform 5s cubic-bezier(0.25, 0.1, 0.25, 1)';
            mixedDoublesWheelCanvas.style.transform = `rotate(${targetRotation}deg)`;

            setTimeout(() => {
                mixedDoublesCurrentRotation = targetRotation % 360;
                mixedDoublesWheelCanvas.style.transition = 'none';
                mixedDoublesWheelCanvas.style.transform = `rotate(${mixedDoublesCurrentRotation}deg)`;

                const drawnTeam = mixedDoublesAvailableTeams.splice(randomIndex, 1)[0];
                const groupName = mixedDoublesGroupA.length < 6 ? 'A' : 'B';
                showPopup(drawnTeam.name, groupName);
                
                setTimeout(() => {
                    mixedDoublesAddToGroup(drawnTeam);
                    mixedDoublesDrawWheel();
                    if (mixedDoublesGroupA.length === 6) {
                        mixedDoublesFillGroupB();
                    } else if (mixedDoublesAvailableTeams.length > 0) {
                        mixedDoublesSpinButton.disabled = false;
                        mixedDoublesSpinButton.innerText = 'Spin to Draw';
                    } else {
                        mixedDoublesDisplayFinalResults();
                    }
                }, 2000);
            }, 5000);
        }

        function mixedDoublesAddToGroup(team) {
            const groupA_size = 6;
            let targetGroup = null;
            if (mixedDoublesGroupA.length < groupA_size) {
                mixedDoublesGroupA.push(team);
                targetGroup = mixedDoublesGroupAList;
            }
            const listItem = document.createElement('li');
            listItem.innerHTML = `<span class="participant-name">${team.name}</span> <span class="participant-department">(${team.department})</span>`;
            targetGroup.appendChild(listItem);
        }
        
        function mixedDoublesFillGroupB() {
            mixedDoublesSpinButton.disabled = true;
            mixedDoublesSpinButton.innerText = 'Finalizing Group B...';
            
            mixedDoublesAvailableTeams.forEach(team => {
                mixedDoublesGroupB.push(team);
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span class="participant-name">${team.name}</span> <span class="participant-department">(${team.department})</span>`;
                mixedDoublesGroupBList.appendChild(listItem);
            });
            mixedDoublesAvailableTeams = [];
            
            mixedDoublesDisplayFinalResults();
        }

        function mixedDoublesDisplayFinalResults() {
            mixedDoublesDrawProcessSection.style.display = 'none';
            mixedDoublesFinalResultsContainer.style.display = 'block';

            mixedDoublesGroupA.forEach(p => {
                const listItem = document.createElement('li');
                listItem.textContent = p.name;
                mixedDoublesFinalGroupAList.appendChild(listItem);
            });
            mixedDoublesGroupB.forEach(p => {
                const listItem = document.createElement('li');
                listItem.textContent = p.name;
                mixedDoublesFinalGroupBList.appendChild(listItem);
            });
        }
        
        mixedDoublesSpinButton.addEventListener('click', mixedDoublesSpinWheel);

        // --- Tab Switching Logic ---
        const maleDrawContainer = document.getElementById('male-draw-container');
        const femaleDrawContainer = document.getElementById('female-draw-container');
        const doublesDrawContainer = document.getElementById('doubles-draw-container');
        const femaleDoublesDrawContainer = document.getElementById('female-doubles-draw-container');
        const mixedDoublesDrawContainer = document.getElementById('mixed-doubles-draw-container');

        const maleLink = document.getElementById('male-link');
        const femaleLink = document.getElementById('female-link');
        const doublesLink = document.getElementById('doubles-link');
        const femaleDoublesLink = document.getElementById('female-doubles-link');
        const mixedDoublesLink = document.getElementById('mixed-doubles-link');

        function hideAllContainers() {
            maleDrawContainer.style.display = 'none';
            femaleDrawContainer.style.display = 'none';
            doublesDrawContainer.style.display = 'none';
            femaleDoublesDrawContainer.style.display = 'none';
            mixedDoublesDrawContainer.style.display = 'none';
        }

        function removeAllActiveClasses() {
            maleLink.classList.remove('active');
            femaleLink.classList.remove('active');
            doublesLink.classList.remove('active');
            femaleDoublesLink.classList.remove('active');
            mixedDoublesLink.classList.remove('active');
        }

        function showDraw(drawType) {
            hideAllContainers();
            removeAllActiveClasses();

            if (drawType === 'male') {
                maleDrawContainer.style.display = 'block';
                maleLink.classList.add('active');
                maleDrawWheel();
            } else if (drawType === 'female') {
                femaleDrawContainer.style.display = 'block';
                femaleLink.classList.add('active');
                femaleDrawWheel();
            } else if (drawType === 'doubles') {
                doublesDrawContainer.style.display = 'block';
                doublesLink.classList.add('active');
                doublesDrawWheel();
            } else if (drawType === 'female-doubles') {
                femaleDoublesDrawContainer.style.display = 'block';
                femaleDoublesLink.classList.add('active');
                femaleDoublesDrawWheel();
            } else if (drawType === 'mixed-doubles') {
                mixedDoublesDrawContainer.style.display = 'block';
                mixedDoublesLink.classList.add('active');
                mixedDoublesDrawWheel();
            }
        }

        maleLink.addEventListener('click', () => showDraw('male'));
        femaleLink.addEventListener('click', () => showDraw('female'));
        doublesLink.addEventListener('click', () => showDraw('doubles'));
        femaleDoublesLink.addEventListener('click', () => showDraw('female-doubles'));
        mixedDoublesLink.addEventListener('click', () => showDraw('mixed-doubles'));

        // Initial draw on page load
        showDraw('male');
    </script>
</body>
</html>
